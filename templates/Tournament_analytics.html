<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tournament Analysis - Badminton Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Navi bar -->
  <nav class="bg-blue-700 text-white p-4 flex justify-between items-center shadow">
    <h1 class="text-xl font-bold">🏸 Tournament Analysis</h1>
    <div>
      <a href="/analytics" class="px-3 hover:underline">← Back to Analysis</a>
      <a href="/dashboard" class="px-3 hover:underline">Dashboard</a>
      <a href="/upload" class="px-3 hover:underline">Upload</a>
      <a href="/logout" class="px-3 hover:underline text-red-300">Log out</a>
    </div>
  </nav>

  <!-- Content -->
  <main class="flex-1 max-w-6xl mx-auto px-4 py-6">
    <div class="mb-6">
      <h2 class="text-2xl font-semibold">🏆 {{ tournament.name }}</h2>
      <p class="text-gray-600 mt-1">
        on {{ tournament.date }} at {{ tournament.location }} analysis
      </p>
    </div>

    <!-- basic stats data -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-white p-5 rounded shadow text-center">
        <p class="text-gray-500">Game count</p>
        <p class="text-3xl font-bold text-blue-700 mt-2">{{ tournament.match_count }}</p>
      </div>
      <div class="bg-white p-5 rounded shadow text-center">
        <p class="text-gray-500">Player</p>
        <p class="text-3xl font-bold text-green-600 mt-2">{{ tournament.player_count }}</p>
      </div>
      <div class="bg-white p-5 rounded shadow text-center">
        <p class="text-gray-500">Game type</p>
        <p class="text-3xl font-bold text-purple-600 mt-2">{{ tournament.match_types|length }}</p>
      </div>
      <div class="bg-white p-5 rounded shadow text-center">
        <p class="text-gray-500">Rounds</p>
        <p class="text-3xl font-bold text-yellow-500 mt-2">{{ tournament.rounds|length }}</p>
      </div>
    </div>

    <!-- Graph -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white p-6 rounded shadow">
        <h3 class="text-lg font-semibold mb-4">📊 Game Type Distribution</h3>
        <canvas id="matchTypeChart" height="250"></canvas>
      </div>
      <div class="bg-white p-6 rounded shadow">
        <h3 class="text-lg font-semibold mb-4">🔄 Match round distribution</h3>
        <canvas id="roundsChart" height="250"></canvas>
      </div>
    </div>

    <!-- High point -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      {% if tournament.longest_match %}
        <div class="bg-white p-6 rounded shadow">
          <h3 class="text-lg font-semibold mb-4">⏱ Longest Match</h3>
          <div class="space-y-3">
            <div>
              <span class="font-medium text-gray-600">Teams:</span>
              <p class="mt-1">{{ tournament.longest_match.team1 }} vs {{ tournament.longest_match.team2 }}</p>
            </div>
            <div>
              <span class="font-medium text-gray-600">Score:</span>
              <p class="mt-1">{{ tournament.longest_match.score1 }}</p>
            </div>
            <div>
              <span class="font-medium text-gray-600">Game Type:</span>
              <p class="mt-1">{{ tournament.longest_match.match_type }}</p>
            </div>
            <div>
              <span class="font-medium text-gray-600">Round count:</span>
              <p class="mt-1">{{ tournament.longest_match.sets }}</p>
            </div>
          </div>
        </div>
      {% endif %}

      {% if tournament.highest_score %}
        <div class="bg-white p-6 rounded shadow">
          <h3 class="text-lg font-semibold mb-4">🔥 最高分比赛</h3>
          <div class="space-y-3">
            <div>
              <span class="font-medium text-gray-600">参赛队伍:</span>
              <p class="mt-1">{{ tournament.highest_score.team1 }} vs {{ tournament.highest_score.team2 }}</p>
            </div>
            <div>
              <span class="font-medium text-gray-600">比分:</span>
              <p class="mt-1">{{ tournament.highest_score.score1 }}</p>
            </div>
            <div>
              <span class="font-medium text-gray-600">比赛类型:</span>
              <p class="mt-1">{{ tournament.highest_score.match_type }}</p>
            </div>
            <div>
              <span class="font-medium text-gray-600">总分:</span>
              <p class="mt-1">{{ tournament.highest_score.total_points }}</p>
            </div>
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Player -->
    <div class="bg-white rounded shadow p-6 mb-10">
      <h3 class="text-xl font-bold mb-4">👥 Tournament player ({{ tournament.players|length }})</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {% for player in tournament.players %}
          <div class="p-3 bg-gray-50 rounded">
            <a href="/analytics/player/{{ player.id }}" class="text-blue-600 hover:underline">
              {{ player.name }}
            </a>
          </div>
        {% endfor %}
      </div>
    </div>
  </main>

  <!-- Foot -->
  <footer class="bg-white text-gray-600 text-sm text-center py-4 border-t">
    © 2025 Badminton Manager · Copyrights Reserved
  </footer>

  <script>
    // Init graph
    document.addEventListener('DOMContentLoaded', function() {
      // Deal with match type
      const matchTypes = {{ tournament.match_types|tojson }};
      const matchTypeLabels = [];
      const matchTypeValues = [];

      for (const type in matchTypes) {
        matchTypeLabels.push(type);
        matchTypeValues.push(matchTypes[type]);
      }

      // Draw event type distribution
      const matchTypeCtx = document.getElementById('matchTypeChart').getContext('2d');
      const matchTypeChart = new Chart(matchTypeCtx, {
        type: 'pie',
        data: {
          labels: matchTypeLabels,
          datasets: [{
            data: matchTypeValues,
            backgroundColor: [
              'rgba(59, 130, 246, 0.7)',
              'rgba(16, 185, 129, 0.7)',
              'rgba(245, 158, 11, 0.7)',
              'rgba(239, 68, 68, 0.7)',
              'rgba(139, 92, 246, 0.7)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Deal with the round data
      const rounds = {{ tournament.rounds|tojson }};
      const roundLabels = [];
      const roundValues = [];

      for (const round in rounds) {
        roundLabels.push(round);
        roundValues.push(rounds[round]);
      }

      // Drwa the round distribution graph
      const roundsCtx = document.getElementById('roundsChart').getContext('2d');
      const roundsChart = new Chart(roundsCtx, {
        type: 'bar',
        data: {
          labels: roundLabels,
          datasets: [{
            label: 'Game count',
            data: roundValues,
            backgroundColor: 'rgba(79, 70, 229, 0.7)',
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              }
            }
          }
        }
      });
    });
  </script>
</body>
</html>